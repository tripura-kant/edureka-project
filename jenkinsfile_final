pipeline {
    agent any

    stages {
        stage('Compile Source Code') {
            steps {
                // Execute the job for compiling source code
                build job: 'pipeline-1-compile'
            }
        }

        stage('Test Source Code') {
            steps {
                // Execute the job for testing source code
                build job: 'pipeline-2-test'
            }
        }

        stage('Package Code and Dockerize') {
            steps {
                // Execute the job for packaging the code
                build job: 'pipeline-3-package'

                // Dockerization steps
                script {
                    // Build a Docker image
                    sh 'docker build -t your-image-name:your-tag -f Dockerfile .'

                    // Deploy to Docker container
                    sh 'docker run -d -p 8080:8080 your-image-name:your-tag'
                }
            }
        }

        stage('Deploy on Kubernetes') {
            steps {
                // Apply Kubernetes manifests using Ansible
                script {
                    sh 'ansible-playbook ansible_playbook_k8s.yml'
                }
            }
        }

        stage('Prometheus Monitoring Setup') {
            steps {
                // Install Node Exporter and configure Prometheus
                script {
                    sh 'ansible-playbook ansible_prometheus_setup.yml'
                }
            }
        }
    }
}
